"Test python ingest script with string manipulation":
  - do:
      ingest.simulate:
        body:
          pipeline:
            processors:
              - script:
                  description: "Extract 'tags' from 'env' field"
                  lang: python
                  source: "ctx['tags'] = ctx['env'].split(params['delimiter'])[params['position']]"
                  params:
                    delimiter: "-"
                    position: 3
          docs:
            - _source:
                env: "us-east-1-prod"

  - match: { docs.0.doc._source.tags: "prod" }
